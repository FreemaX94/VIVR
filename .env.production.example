# Production Environment Configuration
# Copy to .env.production.local and fill in actual values

# ============================================================================
# DATABASE CONFIGURATION - WITH CONNECTION POOLING
# ============================================================================

# Primary database connection (direct to PostgreSQL)
# Use for migration and admin operations
DATABASE_URL="postgresql://user:password@postgres.example.com:5432/vivr?schema=public&sslmode=require&connection_timeout=20"

# Pooled connection (via PgBouncer or RDS Proxy)
# Use this for application connections to handle high concurrency
# Recommended: 20-50 connections depending on server resources
DATABASE_URL_POOLING="postgresql://user:password@pgbouncer.example.com:6432/vivr?schema=public&sslmode=require&connection_limit=30&statement_cache_size=250"

# ============================================================================
# NEXTAUTH CONFIGURATION
# ============================================================================

NEXTAUTH_URL="https://vivr.example.com"
NEXTAUTH_SECRET="your-very-long-random-secret-key-generate-with-openssl-rand-base64-32"

# ============================================================================
# OAUTH PROVIDERS
# ============================================================================

GOOGLE_CLIENT_ID="your-google-client-id.apps.googleusercontent.com"
GOOGLE_CLIENT_SECRET="your-google-client-secret"

APPLE_CLIENT_ID="com.vivr.app"
APPLE_CLIENT_SECRET="your-apple-client-secret"

# ============================================================================
# STRIPE PAYMENT PROCESSING
# ============================================================================

STRIPE_SECRET_KEY="sk_live_your_production_key"
STRIPE_PUBLISHABLE_KEY="pk_live_your_production_key"
STRIPE_WEBHOOK_SECRET="whsec_your_webhook_secret"

# ============================================================================
# PAYPAL PAYMENT PROCESSING
# ============================================================================

PAYPAL_CLIENT_ID="your-paypal-client-id"
PAYPAL_CLIENT_SECRET="your-paypal-client-secret"

# ============================================================================
# CLOUDINARY IMAGE MANAGEMENT
# ============================================================================

CLOUDINARY_CLOUD_NAME="your-cloud-name"
CLOUDINARY_API_KEY="your-api-key"
CLOUDINARY_API_SECRET="your-api-secret"

# ============================================================================
# EMAIL CONFIGURATION - TRANSACTIONAL EMAILS
# ============================================================================

SMTP_HOST="smtp.sendgrid.net"
SMTP_PORT="587"
SMTP_USER="apikey"
SMTP_PASSWORD="your-sendgrid-api-key"
EMAIL_FROM="noreply@vivr.example.com"

# ============================================================================
# REDIS CACHING (OPTIONAL BUT RECOMMENDED)
# ============================================================================

REDIS_URL="redis://redis.example.com:6379"
REDIS_TOKEN="your-redis-auth-token"

# ============================================================================
# MONITORING & OBSERVABILITY
# ============================================================================

# Enable query logging in production (set to false to disable)
LOG_QUERIES="false"

# Sentry error tracking
SENTRY_DSN="https://your-sentry-dsn@sentry.io/project-id"

# DataDog APM
DATADOG_ENABLED="true"
DD_SERVICE="vivr-api"
DD_ENV="production"

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================

# Slow query threshold (milliseconds)
SLOW_QUERY_THRESHOLD="1000"

# Enable request caching headers
CACHE_CONTROL="public, max-age=300"

# ============================================================================
# CHROME EXTENSION API
# ============================================================================

EXTENSION_API_KEY="generate-a-secure-random-key-here"

# ============================================================================
# NODE ENVIRONMENT
# ============================================================================

NODE_ENV="production"

# ============================================================================
# NOTES ON PRODUCTION SECURITY
# ============================================================================

# 1. NEVER commit .env files to version control
# 2. Use environment variable management (Vercel Secrets, AWS Secrets Manager, etc.)
# 3. Rotate secrets regularly
# 4. Use strong randomly generated secrets for:
#    - NEXTAUTH_SECRET
#    - API keys
#    - Database passwords
# 5. Ensure SSL/TLS is enforced (sslmode=require in DATABASE_URL)
# 6. Use connection pooling in production (PgBouncer or RDS Proxy)
# 7. Enable query logging monitoring for performance issues
# 8. Set up automated backups for the database
# 9. Configure firewall rules to restrict database access
# 10. Use read replicas for high-traffic scenarios

# ============================================================================
# CONNECTION POOLING SETUP RECOMMENDATIONS
# ============================================================================

# Option 1: PgBouncer (self-hosted)
# Install: apt-get install pgbouncer
# Configuration example:
# [databases]
# vivr = host=postgres.example.com port=5432 dbname=vivr
#
# [pgbouncer]
# pool_mode = transaction
# max_client_conn = 1000
# default_pool_size = 30
# reserve_pool_size = 5
# reserve_pool_timeout = 3

# Option 2: AWS RDS Proxy
# - Creates connection pool automatically
# - Use: vivr-proxy.proxy-xxxx.region.rds.amazonaws.com:3306

# Option 3: Vercel Postgres
# - Built-in connection pooling
# - Use their pooling connection string

# ============================================================================
# DATABASE OPTIMIZATION CHECKLIST
# ============================================================================

# ✓ Indexes created (run: npx prisma db push)
# ✓ Connection pooling configured
# ✓ Query optimization applied
# ✓ Caching layer configured (Redis)
# ✓ Slow query logging enabled
# ✓ Database backups scheduled
# ✓ Monitoring alerts configured
# ✓ Performance baselines established
